---
date: 2026-02-11
type: project
domain: Product
tags: [telegram, bot, architecture, token-optimization, batch-processing]
related:
  - "[[2026-02-08-telegram-bot-security-app]]"
  - "[[2026-02-10-stalker-media-multi-role-bot]]"
  - "[[цели/3-неделя]]"
---

## Context
Текстовое сообщение 03:46 — идея архитектуры двух Telegram-ботов для экономии токенов.

## Insight
Разделить обработку на два бота:
1. **Бот #1 (Realtime)** — мгновенная фиксация + мгновенная обработка через AI. Для срочных записей.
2. **Бот #2 (Batch/Evening)** — только фиксирует сообщения как есть, без AI-обработки. Вечером (например, 21:00) запускается пакетная обработка всех накопленных записей.

### Плюсы Batch-бота:
- Экономия токенов: одно обращение к AI вместо N отдельных
- Контекст: AI видит все записи за день целиком → лучше классификация
- Меньше API-вызовов → меньше latency-затрат
- Можно группировать похожие записи

### Плюсы Realtime-бота:
- Мгновенная обратная связь пользователю
- Критичные задачи сразу попадают в Todoist
- Не нужно ждать вечера

### Архитектурная схема:
```
Бот #1 (Realtime):  сообщение → AI → Todoist + Vault → ответ
Бот #2 (Batch):     сообщение → хранение → [21:00 cron] → AI → Todoist + Vault → сводка
```

### Экономия токенов (оценка):
- Realtime: ~1000 токенов на запись × N записей = N × 1000
- Batch: ~1500 токенов system prompt + ~200 × N = 1500 + 200N
- Выгода batch при N > 2 записей в день (экономия system prompt overhead)

## Implication
Это естественное расширение текущей second-brain архитектуры. Batch-бот может использовать тот же процессор (dbrain-processor), но вызываться по cron. Realtime-бот — текущий бот. Оба бота могут делить одну и ту же vault-структуру.

## Next Action
Спроектировать Batch-бот: storage layer (SQLite/jsonl), cron trigger, интеграция с текущим processor.

## Related
- [[2026-02-08-telegram-bot-security-app]] — admin panel для ботов
- [[2026-02-10-stalker-media-multi-role-bot]] — мульти-ролевой бот
